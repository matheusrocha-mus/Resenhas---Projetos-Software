# Engenharia de Software Moderna - Marco Tulio Valente

## Capítulo 9

Nesse capítulo o autor introduz o conceito e a prática de refatoração de código, ou refactoring. Este processo envolve a modificação do código-fonte de um programa com o objetivo de melhorar sua estrutura interna, sem alterar seu comportamento externo. A refatoração é essencial para manter a qualidade e a manutenibilidade de sistemas de software ao longo do tempo, especialmente à medida que eles evoluem e se adaptam a novos requisitos e ambientes. O autor inicia destacando que, assim como qualquer produto de engenharia, o software requer manutenção constante. Além das manutenções corretivas, adaptativas e evolutivas, é necessário realizar manutenções preventivas para evitar a deterioração da qualidade interna do sistema. Meir Lehman, na década de 1970, formulou as Leis da Evolução de Software, que apontam que sistemas de software tendem a se tornar mais complexos e difíceis de manter com o tempo, a menos que um esforço consciente seja feito para estabilizar ou melhorar sua estrutura. É nesse contexto que a refatoração se torna crucial, permitindo que desenvolvedores melhorem a manutenibilidade do código sem alterar seu comportamento funcional.

Em seguida, Marco Tulio apresenta diversas operações de refatoração, ilustradas com exemplos de código, alguns extraídos de sistemas de código aberto. Essas operações são transformações específicas aplicadas ao código para melhorar sua estrutura. Entre as principais destacam-se:

- Extração de Método (Extract Method): Consiste em criar um novo método a partir de um fragmento de código presente em um método maior. Isso aumenta a legibilidade e possibilita o reúso do código. Por exemplo, ao desenvolver uma aplicação financeira, podemos identificar cálculos repetidos de juros em diferentes partes do código. Ao extrair esse cálculo para um método separado, facilitamos futuras alterações na fórmula de cálculo, garantindo consistência em toda a aplicação.

- Inline de Método (Inline Method): Ocorre quando um método é pequeno e sua existência não se justifica. Nesse caso, seu conteúdo pode ser inserido diretamente nos locais onde é chamado. Embora menos comum, essa prática pode simplificar o código ao eliminar métodos desnecessários. Por exemplo, se temos um método que apenas retorna o valor de um atributo sem qualquer processamento adicional, podemos considerar incorporar essa chamada diretamente, reduzindo a sobrecarga de chamadas de métodos triviais.

- Renomear (Rename): Envolve alterar o nome de variáveis, métodos ou classes para refletir melhor seu propósito. Nomes claros e descritivos facilitam o entendimento do código por outros desenvolvedores. Por exemplo, em um sistema de gerenciamento de estoque, uma variável chamada qtd pode ser renomeada para quantidadeEmEstoque, tornando seu propósito mais evidente.

- Mover Método ou Campo (Move Method/Field): Quando um método ou atributo é mais relevante em outra classe, faz sentido movê-lo para essa nova localização. Isso melhora a coesão e reduz o acoplamento entre classes. Por exemplo, se um método que calcula o desconto de um produto está na classe CarrinhoDeCompras, mas utiliza apenas dados da classe Produto, pode ser mais apropriado mover esse método para a classe Produto.

- Substituir Condicional por Polimorfismo (Replace Conditional with Polymorphism): Esta refatoração substitui estruturas condicionais complexas por polimorfismo, aproveitando a orientação a objetos para tornar o código mais extensível e fácil de manter. Por exemplo, em um sistema de processamento de pedidos, diferentes tipos de pedidos podem exigir tratamentos específicos. Em vez de usar uma série de condicionais para verificar o tipo de pedido, podemos criar uma hierarquia de classes onde cada tipo de pedido é representado por uma subclasse que implementa seu comportamento específico.

A prática contínua de refatoração é fundamental para manter a saúde do código. O capítulo enfatiza a importância de uma suíte abrangente de testes de unidade para garantir que as alterações não introduzam novos bugs. Antes de iniciar a refatoração, é crucial que todos os testes estejam passando, assegurando que o sistema esteja em um estado estável. Após cada pequena modificação, os testes devem ser reexecutados para confirmar que o comportamento do sistema permanece correto. Essa abordagem incremental minimiza riscos e facilita a identificação de problemas introduzidos durante o processo de refatoração. No mercado, a aplicação disciplinada da refatoração pode ser observada em empresas que adotam metodologias ágeis, como o Scrum ou o Extreme Programming (XP). Nesses ambientes, a refatoração é incorporada como parte do processo de desenvolvimento contínuo, permitindo que o código evolua de maneira sustentável e se adapte rapidamente às mudanças nos requisitos de negócio. Ferramentas modernas de desenvolvimento, como IDEs (Ambientes de Desenvolvimento Integrado), oferecem suporte significativo para a refatoração. Recursos automatizados permitem que desenvolvedores apliquem operações de refatoração com segurança e eficiência. Por exemplo, ao renomear uma classe ou método, a IDE pode atualizar automaticamente todas as referências a esse elemento em todo o projeto, reduzindo a possibilidade de erros humanos. Além disso, ferramentas como o Eclipse, IntelliJ IDEA e Visual Studio fornecem funcionalidades para detectar code smells e sugerir refatorações apropriadas, auxiliando na manutenção de um código limpo e bem estruturado.

O autor prossegue para falar do conceito de code smells, que consistem em indicadores de que algo não está bem na estrutura do código. Embora não sejam bugs propriamente ditos, eles sugerem áreas que podem se beneficiar de uma refatoração. Alguns exemplos comuns incluem:

- Código Duplicado (Duplicated Code): Ocorre quando blocos de código idênticos ou muito semelhantes aparecem em diferentes partes do sistema. Isso pode dificultar a manutenção, pois uma alteração necessária em um trecho duplicado precisa ser replicada em todos os outros locais. A refatoração recomendada é a Extração de Método, onde o código duplicado é movido para um único método que é então chamado nos diferentes locais.

- Método Longo (Long Method): Métodos que se estendem por muitas linhas de código podem ser difíceis de entender e manter. A solução é dividir esses métodos em métodos menores e mais específicos, cada um responsável por uma única tarefa. Isso melhora a clareza e facilita testes unitários.

- Classe Grande (Large Class): Classes que acumulam muitas responsabilidades tendem a crescer excessivamente, tornando-se difíceis de gerenciar. A refatoração aqui pode envolver a Extração de Classe, onde partes da funcionalidade são movidas para novas classes mais coesas.

- Lista Longa de Parâmetros (Long Parameter List): Métodos que requerem muitos parâmetros podem indicar que a estrutura de dados não está bem definida. Uma abordagem para resolver isso é a Introdução de Objeto de Parâmetro, criando um objeto que encapsula os parâmetros relacionados.

- Inveja de Função (Feature Envy): Quando um método em uma classe acessa frequentemente dados de outra classe, pode ser um sinal de que esse método pertence à outra classe. Nesse caso, a refatoração Mover Método pode ser aplicada para realocar o método para a classe mais apropriada.

O autor ressalta a importância de saber reconhecer e abordar code smells para manter a saúde e a qualidade do código a longo prazo. Ferramentas modernas de desenvolvimento, como IDEs, oferecem suporte para identificar e corrigir muitos desses problemas de forma automatizada, auxiliando os desenvolvedores no processo contínuo de refatoração. No mercado, a prática de identificar e corrigir code smells é amplamente adotada por equipes que seguem metodologias ágeis. A refatoração contínua permite que o código se adapte rapidamente a novas demandas de negócio, mantendo sua qualidade e facilitando futuras evoluções. Além disso, a utilização de ferramentas que detectam automaticamente esses "cheiros" de código contribui para a eficiência e eficácia do processo de desenvolvimento.

Em resumo, este capítulo destaca a importância da refatoração como uma prática essencial na engenharia de software moderna. Ao identificar e corrigir code smells, os desenvolvedores podem garantir que seus sistemas permaneçam robustos, manuteníveis e alinhados com as necessidades em constante mudança do mercado.

Este capítulo foi um dos que me geraram reflexão, porquê em minha jornada como desenvolvedor em diversos momentos eu já me deparei com situações em que:

- Percebi a necessidade de refatoração de código e não fiz a refatoração da melhor maneira possível

- Percebi a necessidade de refatoração de código porém não fiz a refatoração por certos motivos (e.g. limitações de entrega da equipe, restrições de disponibilidade do time)

- Só fui perceber o quanto o meu código "smelled" muito tempo depois de concluir o projeto, quando já estava mais experiente como desenvolvedor

Em todas essas situações, ter mais conhecimento sobre refatoração e code smells teria me ajudado muito, e esse capítulo me instiga a estudar mais sobre o assunto para que este tipo de situação se torne menos recorrente no futuro.